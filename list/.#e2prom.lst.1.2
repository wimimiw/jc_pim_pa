C51 COMPILER V7.06   E2PROM                                                                04/24/2006 10:56:54 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE E2PROM
OBJECT MODULE PLACED IN .\OUTPUT\e2prom.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE drive\e2prom.c BROWSE INCDIR(.\APP;.\drive;.\LPC900) DEBUG OBJECTEXTEND PRI
                    -NT(.\list\e2prom.lst) OBJECT(.\OUTPUT\e2prom.obj)

stmt level    source

   1          /**-------------文件信息--------------------------------------------------------------------------------
   2          **文   件   名: e2prom.c
   3          **创   建   人: 程莺红
   4          **修   改   人: 
   5          **最后修改日期: 2006年3月31日
   6          **最 新 版  本: V1.2
   7          **描        述:对LPC938上的EEPROM进行读写操作
   8          **
   9          **--------------历史版本信息----------------------------------------------------------------------------
  10          ** 创建人: 程莺红 
  11          ** 版  本: V1.2
  12          ** 日　期: 2006年3月31日
  13          ** 描　述: 原始版本
  14          **
  15          ********************************************************************************************************/
  16          
  17          #include <reg938.h>
  18          #include <e2prom.h>
  19          
  20          #define MSK_DEECON_FINISH 0x80
  21          
  22          unsigned char readE2prom(unsigned int address)  
  23          {
  24   1              register unsigned char eeprom_value;
  25   1              bit ea_save;
  26   1              unsigned int temp;
  27   1      
  28   1              temp = address;                                                 
  29   1              temp >>= 8;
  30   1              temp &= 0x0001;                                                 //取得第八位地址数据
  31   1      
  32   1              ea_save = EA;
  33   1              EA=0;
  34   1              DEECON = (unsigned char)temp;                   //给DEECON赋值，其中ECTL1＝0，ECTL0＝0，最低位位第八为地址数据
  35   1      
  36   1              temp = address;                                                 
  37   1              temp &= 0x00FF;
  38   1              DEEADR = (unsigned char)temp;                   //前七位地址数据写入DEEADR
  39   1      
  40   1              while((DEECON & MSK_DEECON_FINISH) == 0)    //等待是否读完成
  41   1              {               
  42   2              }
  43   1              
  44   1              DEECON &= 0x7F;
  45   1              eeprom_value = DEEDAT ;  
  46   1              EA=ea_save;                                                             //保存中断状态
  47   1      
  48   1              return eeprom_value;
  49   1      }
  50          
  51          
  52          void writeE2prom(unsigned int address, unsigned char value) 
  53          {
  54   1          bit ea_save;
C51 COMPILER V7.06   E2PROM                                                                04/24/2006 10:56:54 PAGE 2   

  55   1              unsigned int temp;
  56   1      
  57   1              temp = address;
  58   1              temp >>= 8;
  59   1              temp &= 0x0001;                                                 //取得第八位地址数据
  60   1      
  61   1              ea_save = EA;
  62   1              EA=0;
  63   1              DEECON = (unsigned char)temp;                   //给DEECON赋值，其中ECTL1＝0，ECTL0＝0，最低位位第八为地址数据
  64   1              
  65   1              DEEDAT = value;                                                 //要写入的数据                                  
  66   1              
  67   1              temp = address;
  68   1              temp &= 0x00FF;
  69   1              DEEADR = (unsigned char)temp;                   //前七位地址数据写入DEEADR      
  70   1              while((DEECON & MSK_DEECON_FINISH) == 0)        //等待是否写完成
  71   1              {
  72   2              }       
  73   1              DEECON &= 0x7F;
  74   1      
  75   1              EA=ea_save;     
  76   1      } 
  77          
  78          void writeE2promStr(unsigned char len_car, unsigned int adr_eeprom, unsigned char *src) 
  79          {
  80   1              unsigned char i;
  81   1      
  82   1              for (i=0; i<len_car; i++)
  83   1              {
  84   2                      writeE2prom(adr_eeprom++, src[i]);
  85   2              }
  86   1              
  87   1      }
  88          
  89          void readE2promStr(unsigned char len_car, unsigned int adr_eeprom, unsigned char *dest) 
  90          {
  91   1              unsigned char i;
  92   1              
  93   1              for (i=0; i<len_car; i++)
  94   1              {
  95   2                      *dest++ = readE2prom(adr_eeprom++);
  96   2              }
  97   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    182    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
